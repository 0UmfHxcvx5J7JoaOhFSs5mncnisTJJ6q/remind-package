{
    "collab_server" : "",
    "contents" : "#' Read in GDX and calculate emissions, used in convGDX2MIF.R for the\n#' reporting\n#'\n#' Read in emission information from GDX file, information used in\n#' convGDX2MIF.R for the reporting\n#'\n#'\n#' @param gdx a GDX as created by readGDX, or the file name of a gdx\n#' @author Jessica Streffler, Lavinia Baumstark, Michaja Pehl\n#' @examples\n#'\n#'   \\dontrun{reportEmi(gdx)}\n#' @export\n#' @importFrom gdx readGDX\n#' @importFrom magclass getNames<- getYears collapseNames mbind getYears new.magpie getRegions setYears dimSums mselect \n#' @importFrom dplyr inner_join select filter group_by summarise ungroup mutate\n#'             tbl_df rename\n#' @importFrom tidyr complete nesting\n#' @importFrom quitte as.quitte character.data.frame\n#' @importFrom rlang .data\n\nreportEmi <- function(gdx){\n  ####### conversion factors ##########\n  s_GWP_CH4 <- readGDX(gdx,c(\"sm_gwpCH4\",\"s_gwpCH4\",\"s_GWP_CH4\"),format=\"first_found\", react = \"silent\")\n  s_GWP_N2O <- readGDX(gdx,c(\"s_gwpN2O\",\"s_GWP_N2O\"),format=\"first_found\")\n  pm_conv_TWa_EJ <- 31.536\n  TWa_2_EJ <- 31.536\n  GtC_2_MtCO2 <- 44 / 12 * 1000\n  \n  ####### read in needed data #########\n  module2realisation <- readGDX(gdx, \"module2realisation\")\n  \n  ppfen_stat  <- readGDX(gdx, c(\"ppfen_stationary_dyn38\",\n                                \"ppfen_stationary_dyn28\",\n                                \"ppfen_stationary\"),\n                         format = \"first_found\", react = \"silent\")\n  ppfen_build <- readGDX(gdx, c(\"ppfen_buildings_dyn36\",\n                                \"ppfen_buildings_dyn28\",\n                                \"ppfen_buildings\"),\n                         format = \"first_found\", react = \"silent\")\n  ppfen_ind   <- readGDX(gdx, c(\"ppfen_industry_dyn37\", \"ppfen_industry_dyn28\", \n                                \"ppfen_industry\"),\n                         format = \"first_found\", react = \"silent\")\n  # Realisation of the different modules\n  \n  if ( !is.null(module2realisation) \n       & (!\"CES_structure\" %in% module2realisation[,1])) {\n    stat_mod = module2realisation['stationary' == module2realisation$modules,2]\n    tran_mod = module2realisation['transport'  == module2realisation$modules,2]\n    indu_mod = module2realisation['industry'   == module2realisation$modules,2]\n    buil_mod = module2realisation['buildings'  == module2realisation$modules,2]\n  } else {                     \n    # In case the set module2realisation did not exist, find out whether it was \n    # stationary or buildings-industry\n    if (!is.null(ppfen_stat)) {\n      stat_mod = \"simple\"\n      indu_mod = \"off\"\n      buil_mod = \"off\"\n    } else {\n      stat_mod = \"off\"\n      indu_mod = \"fixed_shares\"\n      buil_mod = \"simple\"\n    }\n  }\n  \n  ## switches\n  cm_emiscen <- readGDX(gdx,\"cm_emiscen\")\n  ## sets\n  pebio      <- readGDX(gdx,c(\"peBio\",\"pebio\"),format=\"first_found\")\n  emi2te     <- readGDX(gdx,\"emi2te\")\n  cintbyfuel <- readGDX(gdx,c(\"emi2fuelMine\",\"cintbyfuel\"),format=\"first_found\")\n  pe2se      <- readGDX(gdx,\"pe2se\")\n  se2fe      <- readGDX(gdx,\"se2fe\")\n  fe2es      <- readGDX(gdx,\"fe2es\")\n  fety       <- readGDX(gdx,c(\"entyFe\",\"fety\"),format=\"first_found\")\n  sety       <- readGDX(gdx,c(\"entySe\",\"sety\"),format=\"first_found\")\n  pety       <- readGDX(gdx,c(\"entyPe\",\"pety\"),format=\"first_found\")\n  oc2te      <- readGDX(gdx,c(\"pc2te\",\"oc2te\"),format=\"first_found\")\n  teccs    <- readGDX(gdx,c(\"teCCS\",\"teccs\"),format=\"first_found\")\n  tebio    <- readGDX(gdx,c(\"teBio\"),format=\"first_found\")\n  peFos    <- readGDX(gdx,c(\"peFos\"),format=\"first_found\")\n  \n  \n  potentialseLiq <- c(\"seliq\",\"sepet\",\"sedie\")  # the sety liquids changed from sepet+sedie to seLiq in REMIND 1.7\n  se_Liq    <- intersect(potentialseLiq,sety)\n  \n  FE_Liq   <- intersect(c(\"fehos\",\"fehob\",\"fehoi\",\"fepet\",\"fedie\",\"feliq\"),fety)\n  FE_Ga    <- intersect(c(\"fegas\",\"fegab\",\"fegai\"),fety)\n  FE_H2    <- intersect(c(\"feh2s\",\"feh2b\",\"feh2i\",\"feh2t\"),fety)\n  FE_So    <- intersect(c(\"fesos\",\"fesob\",\"fesoi\"),fety)\n  FE_He    <- intersect(c(\"fehes\",\"feheb\",\"fehei\"),fety)\n  FE_El    <- intersect(c(\"feels\",\"feeli\",\"feelb\",\"feelt\"),fety)\n  \n  FE_Stat_fety     <- c(\"fegas\", \"fehos\", \"fesos\", \"feh2s\", \"fehes\", \"feels\")\n  FE_Transp_fety35 <- readGDX(gdx,\"FE_Transp_fety35\")\n  LDV35      <- readGDX(gdx,\"LDV35\")\n  emismacmagpiech4 <- readGDX(gdx,c(\"emiMacMagpieCH4\",\"emismacmagpiech4\"),format=\"first_found\")\n  emismacmagpien2o <- readGDX(gdx,c(\"emiMacMagpieN2O\",\"emismacmagpien2o\"),format=\"first_found\")\n  ## parameter or variable - see next lines\n  p_emi_fgas <- readGDX(gdx,c(\"pm_emiFgas\",\"p_emiFgas\",\"p_emi_fgas\"),format=\"first_found\", react = \"silent\")\n  #LB# if old names are used rename set elements\n  if (is.element(\"Emissions|F-Gases\",magclass::getNames(p_emi_fgas))) {\n    magclass::getNames(p_emi_fgas) <- gsub(\"\\\\|\",\"_\", magclass::getNames(p_emi_fgas))\n    oldNames <- c(\"Emissions_F-Gases\",\"Emissions_PFC\",\"Emissions_CF4\",\"Emissions_C2F6\",\"Emissions_C6F14\",\"Emissions_HFC_HFC23\",\"Emissions_HFC_HFC32\",\n                  \"Emissions_HFC_HFC43-10\",\"Emissions_HFC_HFC125\",\"Emissions_HFC_HFC134a\",\"Emissions_HFC_HFC143a\",\"Emissions_HFC_HFC227ea\",\"Emissions_HFC_HFC245fa\",\"Emissions_SF6\",\"Emissions_HFC\")\n    newNames <- c(\"emiFgasTotal\",\"emiFgasPFC\",\"emiFgasCF4\",\"emiFgasC2F6\",\"emiFgasC6F14\",\"emiFgasHFC23\",\"emiFgasHFC32\",\"emiFgasHFC43-10\",\"emiFgasHFC125\",\n                  \"emiFgasHFC134a\",\"emiFgasHFC143a\",\"emiFgasHFC227ea\",\"emiFgasHFC245fa\",\"emiFgasSF6\",\"emiFgasHFC\")\n    for( i in 1:length(oldNames))  {\n      magclass::getNames(p_emi_fgas) <- gsub(oldNames[i],newNames[i], magclass::getNames(p_emi_fgas))\n    }\n  }\n  if(is.null(p_emi_fgas)){p_emi_fgas <- readGDX(gdx,name=\"vm_emiFgas\",field=\"l\",restore_zeros=FALSE)}\n  #  p11_emi_aerosol <- readGDX(gdx,\"p11_emi_aerosol\")\n  pm_emi_limits_wp4 <- readGDX(gdx,c(\"p11_emi_limits_wp4\", \"pm_emi_limits_wp4\"),format=\"first_found\", react = \"silent\")\n  pm_limits_wp4_rcp <- readGDX(gdx,\"pm_limits_wp4_rcp\",restore_zeros=FALSE, react = \"silent\")\n  p_cint            <- readGDX(gdx, c(\"pm_cint\",\"p_cint\") ,format=\"first_found\", react = \"silent\")\n  p_share_seel_s    <- readGDX(gdx, \"p_share_seel_s\")\n  p_share_seh2_s    <- readGDX(gdx, \"p_share_seh2_s\")\n  p_share_seliq_s   <- readGDX(gdx, \"p_share_seliq_s\")\n  p_ef_dem          <- readGDX(gdx, \"p_ef_dem\")\n  p_bioshare        <- readGDX(gdx, \"p_bioshare\")\n  p_share_seel_t    <- readGDX(gdx, \"p_share_seel_t\")\n  p_share_seh2_t    <- readGDX(gdx, \"p_share_seh2_t\")\n  p_share_seliq_t   <- readGDX(gdx, \"p_share_seliq_t\")\n  p_share_seel_t_ldv  <- readGDX(gdx, \"p_share_seel_t_ldv\")\n  p_share_seh2_t_ldv  <- readGDX(gdx, \"p_share_seh2_t_ldv\")\n  p_share_seliq_t_ldv <- readGDX(gdx, \"p_share_seliq_t_ldv\")\n  p35_bunker_share_in_nonldv_fe <- readGDX(gdx, c(\"pm_bunker_share_in_nonldv_fe\",\"p35_bunker_share_in_nonldv_fe\"),format=\"first_found\")\n  ppfen_stat   <- readGDX(gdx,c(\"ppfen_stationary_dyn38\",\"ppfen_stationary_dyn28\",\"ppfen_stationary\"),format=\"first_found\", react = \"silent\")\n  \n  pm_ts             <- readGDX(gdx,\"pm_ts\")\n  o37_emiInd <- readGDX(gdx, \"o37_emiInd\", restore_zeros = FALSE,\n                        react = \"silent\")\n  o37_cementProcessEmissions <- readGDX(gdx, \"o37_cementProcessEmissions\",\n                                        restore_zeros = FALSE,\n                                        react = \"silent\")\n  \n  o37_cementProcessEmissions[is.na(o37_cementProcessEmissions)] <- 0\n  \n  p_eta_conv       <- readGDX(gdx, c(\"pm_eta_conv\",\"p_eta_conv\"), restore_zeros = FALSE,format=\"first_found\")\n  dataoc_tmp       <- readGDX(gdx,c(\"pm_prodCouple\",\"p_prodCouple\",\"p_dataoc\"),restore_zeros=FALSE,format=\"first_found\") \n  dataoc_tmp[is.na(dataoc_tmp)] <- 0\n  #### adjust regional dimension of dataoc\n  dataoc <- new.magpie(getRegions(p_eta_conv),getYears(dataoc_tmp),magclass::getNames(dataoc_tmp),fill=0)\n  dataoc[getRegions(dataoc_tmp),,] <- dataoc_tmp\n  getSets(dataoc) <- getSets(dataoc_tmp)\n  \n  ####### fix negative values to 0 ##################\n  dataoc[dataoc<0] <- 0\n  oc2te    <- readGDX(gdx,c(\"pc2te\",\"oc2te\"),format=\"first_found\")\n  \n  ## variables\n  v_emi          <- readGDX(gdx,name=c(\"vm_emiTeDetail\",\"v_emiTeDetail\",\"v_emi\"),field=\"l\",restore_zeros=FALSE,format=\"first_found\", react = \"silent\")\n  vm_co2CCS      <- readGDX(gdx,name=c(\"vm_co2CCS\",\"v_co2CCS\",\"v_ccs\"),field=\"l\",restore_zeros=FALSE,format=\"first_found\")\n  vm_emiengregi  <- readGDX(gdx,name=c(\"vm_emiTe\",\"vm_emiengregi\"),field=\"l\",format=\"first_found\")\n  vm_eminegregi  <- readGDX(gdx,name=c(\"vm_emiMacSector\",\"vm_eminegregi\"),field=\"l\",format=\"first_found\")\n  vm_emicdrregi  <- readGDX(gdx,name=c(\"vm_emiCdr\",\"vm_emicdrregi\"),field=\"l\",format=\"first_found\")\n  v33_emiEW      <- readGDX(gdx,name=c(\"v33_emiEW\"),field=\"l\",format=\"first_found\",react=\"silent\")\n  v33_emiDAC     <- readGDX(gdx,name=c(\"v33_emiDAC\"),field=\"l\",format=\"first_found\",react=\"silent\")\n  vm_sumeminegregi  <- readGDX(gdx,name=c(\"vm_emiMac\",\"vm_sumeminegregi\"),field=\"l\",format=\"first_found\")\n  vm_fuelex      <- readGDX(gdx, name = c(\"vm_fuExtr\",\"vm_fuelex\", \"vm_fuelextmp\"), field=\"l\",format = \"first_found\")\n  vm_prodSE      <- readGDX(gdx,name=c(\"vm_prodSe\",\"v_seprod\"),field=\"l\",restore_zeros=FALSE,format=\"first_found\") * pm_conv_TWa_EJ\n  vm_prodSE      <- vm_prodSE[pe2se]\n  vm_prodFe      <- readGDX(gdx,name=c(\"vm_prodFe\",\"v_feprod\",\"vm_feprod\"),field=\"l\",restore_zeros=FALSE,format=\"first_found\") * pm_conv_TWa_EJ\n  vm_prodFe      <- vm_prodFe[se2fe]\n  vm_demFe       <- readGDX(gdx,name=c(\"v_demFe\",\"vm_demFe\"),field=\"l\",restore_zeros=FALSE,format=\"first_found\") * pm_conv_TWa_EJ\n  vm_demFe       <- vm_demFe[fe2es]\n  vm_demSe       <- readGDX(gdx,name=c(\"vm_demSe\",\"v_demSe\",\"v_sedem\",\"vm_sedem\"),field=\"l\",restore_zeros=FALSE,format=\"first_found\") * pm_conv_TWa_EJ\n  vm_demSe       <- vm_demSe[se2fe]\n  v_co2eq        <- readGDX(gdx,name=c(\"vm_co2eq\",\"v_co2eq\"),field=\"l\",format=\"first_found\")\n  vm_perm        <- readGDX(gdx,name=c(\"vm_perm\"),field=\"l\",format=\"first_found\")\n  vm_cesIO       <- readGDX(gdx,\"vm_cesIO\",field=\"l\",format=\"first_found\") * pm_conv_TWa_EJ\n  vm_macBase     <- readGDX(gdx, \"vm_macBase\", field = \"l\",\n                            restore_zeros = FALSE)\n  \n  vm_macBaseInd    <- readGDX(gdx, c('vm_macBaseInd', \"v37_macBaseInd\"), field = \"l\", format = \"first_found\")\n  vm_emiIndCCS     <- readGDX(gdx, 'vm_emiIndCCS', field = 'l', format = 'first_found')\n  v37_emiIndCCSmax <- readGDX(gdx, 'v37_emiIndCCSmax', field = 'l', format = 'first_found')\n  pm_macSwitch     <- readGDX(gdx, \"pm_macSwitch\", field = \"l\",format=\"first_found\")\n  pm_macAbatLev    <- readGDX(gdx, \"pm_macAbatLev\", field = \"l\",format=\"first_found\")\n  \n  \n  ####### calculate minimal temporal resolution #####\n  y <- Reduce(intersect,list(getYears(v_emi),getYears(vm_emiengregi),getYears(vm_eminegregi),getYears(vm_emicdrregi),getYears(vm_sumeminegregi),getYears(vm_fuelex)))\n  v_emi            <- v_emi[,y,]\n  vm_emiengregi    <- vm_emiengregi[,y,]\n  vm_eminegregi    <- vm_eminegregi[,y,]\n  vm_emicdrregi    <- vm_emicdrregi[,y,]\n  vm_prodSE        <- vm_prodSE[,y,]\n  if(!is.null(v33_emiEW)) {v33_emiEW        <- v33_emiEW[,y,]}\n  if(!is.null(v33_emiDAC)) {v33_emiDAC       <- v33_emiDAC[,y,]}\n  vm_sumeminegregi <- vm_sumeminegregi[,y,]\n  vm_fuelex        <- vm_fuelex[,y,]\n  \n  p_share_seel_s   <- p_share_seel_s[,y,]\n  p_share_seh2_s   <- p_share_seh2_s[,y,]\n  p_share_seliq_s  <- p_share_seliq_s[,y,]\n  p_share_seel_t   <- p_share_seel_t[,y,]\n  p_share_seh2_t   <- p_share_seh2_t[,y,]\n  p_share_seliq_t  <- p_share_seliq_t[,y,]\n  p_share_seel_t_ldv   <- p_share_seel_t_ldv[,y,]\n  p_share_seh2_t_ldv   <- p_share_seh2_t_ldv[,y,]\n  p_share_seliq_t_ldv  <- p_share_seliq_t_ldv[,y,]\n  p35_bunker_share_in_nonldv_fe <- p35_bunker_share_in_nonldv_fe[,y,]\n  p_eta_conv       <- p_eta_conv[,y,]\n  v_co2eq          <- v_co2eq[,y,]\n  v_co2eq          <- v_co2eq[,y,]\n  vm_perm          <- vm_perm[,y,]\n  p_bioshare       <- p_bioshare[,y,]\n  p_emi_fgas       <- p_emi_fgas[,y,]\n  vm_cesIO         <- vm_cesIO[,y,]\n  \n  vm_macBaseInd   <- vm_macBaseInd[,y,]\n  pm_macAbatLev <- pm_macAbatLev[,y,]\n  \n  \n  emiInd37    <- readGDX(gdx,c(\"emiInd37\"),format=\"first_found\")\n  secInd37    <- readGDX(gdx,c(\"secInd37\"),format=\"first_found\")\n  secInd37_2_emiInd37 <- readGDX(gdx,c(\"secInd37_2_emiInd37\"),format=\"first_found\")\n  \n  # pm_macSwitch <- mselect(pm_macSwitch,all_enty = emiInd37) \n  \n  \n  # vm_macBaseIndRed <- collapseNames(mselect(vm_macBaseInd,all_enty = \"fegas\",secInd37 = secInd37_2_emiInd37$secInd37))\n  # a <- dimSums(vm_macBaseIndRed[,,] * setNames(pm_macSwitch[,,secInd37_2_emiInd37$emiInd37],secInd37_2_emiInd37$secInd37) * setNames(pm_macAbatLev[,,secInd37_2_emiInd37$emiInd37],secInd37_2_emiInd37$secInd37),3)\n  # \n  \n  \n  #set calculation\n  pe2se_bioCCS   <- pe2se[pe2se$all_te %in% intersect(tebio, teccs),]\n  pe2se_noBioCCS <- pe2se[!pe2se$all_te %in% intersect(tebio, teccs),]\n  oc2te <- oc2te[!((oc2te$all_te==\"gaschp\" & oc2te$all_enty2==\"sega\")|\n                     (oc2te$all_te==\"refped\" & oc2te$all_enty2==\"seel\")|\n                     (oc2te$all_te==\"refpet\" & oc2te$all_enty2==\"sehe\")|\n                     (oc2te$all_te==\"refdip\" & oc2te$all_enty2==\"seel\")|\n                     (oc2te$all_te==\"refdip\" & oc2te$all_enty2==\"sehe\")|\n                     (oc2te$all_te==\"gash2\" & oc2te$all_enty2==\"sega\")|\n                     (oc2te$all_te==\"gash2c\" & oc2te$all_enty2==\"sega\")),]\n  \n  ###### Compute share parameter\n  if (is.null(ppfen_stat)){\n    \n    build_elec = grep(\"elb$\", ppfen_build, value = T)\n    build_solids = grep(\"sob$\", ppfen_build, value = T)\n    build_gas = grep(\"gab$\", ppfen_build, value = T)\n    build_liq = grep(\"hob$\", ppfen_build, value = T)\n    build_heat = grep(\"heb$\", ppfen_build, value = T)\n    build_hydro = grep(\"h2b$\", ppfen_build, value = T)\n    \n    indu_elec = grep(\"eli$\", ppfen_ind, value = T)\n    indu_solids = grep(\"soi$\", ppfen_ind, value = T)\n    indu_gas = grep(\"gai$\", ppfen_ind, value = T)\n    indu_liq = grep(\"hoi$\", ppfen_ind, value = T)\n    indu_heat = grep(\"hei$\", ppfen_ind, value = T)\n    indu_hydro = grep(\"h2i$\", ppfen_ind, value = T)\n    \n    p_share_feels_b <- collapseNames(dimSums(vm_cesIO[,y,build_elec],dim=3)/ vm_prodFe[,y,\"feels\"])\n    p_share_feels_i <- 1 - p_share_feels_b\n    p_share_fehos_b <- collapseNames(dimSums(vm_cesIO[,y,build_liq],dim=3)/ vm_prodFe[,y,\"fehos\"])\n    p_share_fehos_i <- 1 - p_share_fehos_b\n    p_share_fegas_b <- collapseNames(dimSums(vm_cesIO[,y,build_gas],dim=3)/ vm_prodFe[,y,\"fegas\"])\n    p_share_fegas_i <- 1 - p_share_fegas_b\n    p_share_fehes_b <- collapseNames(dimSums(vm_cesIO[,y,build_heat],dim=3)/ (dimSums(vm_cesIO[,y,build_heat],dim=3) + dimSums(vm_cesIO[,y,indu_heat],dim=3)))\n    p_share_fehes_i <- 1 - p_share_fehes_b\n    p_share_feh2s_b <- collapseNames(dimSums(vm_cesIO[,y,build_hydro],dim=3)/ vm_prodFe[,y,\"feh2s\"])\n    p_share_feh2s_i <- 1 - p_share_feh2s_b\n    p_share_fesos_b <- collapseNames(dimSums(vm_cesIO[,y,build_solids],dim=3)/ vm_prodFe[,y,\"fesos\"])\n    p_share_fesos_i <- 1 - p_share_fesos_b\n    p_share_fety_b <- mbind(p_share_feels_b,p_share_fehos_b,p_share_fegas_b,p_share_fehes_b,p_share_feh2s_b,p_share_fesos_b)\n    magclass::getNames(p_share_fety_b)<- c(\"feels\",\"fehos\",\"fegas\",\"fehes\",\"feh2s\",\"fesos\")\n    p_share_fety_i <- mbind(p_share_feels_i,p_share_fehos_i,p_share_fegas_i,p_share_fehes_i,p_share_feh2s_i,p_share_fesos_i)\n    magclass::getNames(p_share_fety_i)<- c(\"feels\",\"fehos\",\"fegas\",\"fehes\",\"feh2s\",\"fesos\")\n  }\n  \n  ####### internal function for cumulated values ############\n  cumulatedValue <- function(var,i_pm_ts=pm_ts){\n    ts <- i_pm_ts[,getYears(var),]\n    tmp <- new.magpie(getRegions(var),getYears(var),magclass::getNames(var),fill=0)\n    for( t in 2:length(getYears(var))){\n      tmp[,t,] <-  setYears(\n        dimSums(var[,which(getYears(var) < getYears(var)[t]),] * ts[,which(getYears(var) < getYears(var)[t]),],dim=2)\n        - setYears(var[,2005,] * ts[,2005,], NULL) / 2   # half of 2005 time step\n        + setYears(var[,t   ,] * ts[,t   ,], NULL) / 2   # half of last time step\n        , NULL)\n    }\n    return(tmp)\n  }\n  \n  #   emi_carrier(v_emi,dataoc,oc2te,sety,pety,\"seel\",\"co2\",44/12*1000,te=pe2se$all_te,  name=\"Emissions|CO2|Energy|Supply|Electricity (Mt CO2/yr)\"),\n  \n  ####### internal function for reporting of coupled production PE2SE ###########   secarrier is the primary SE for which the analysis is performed\n  emi_carrier <- function(v_emi,dataoc,oc2te,sety,pecarrier,secarrier,emity,factor,te=pe2se$all_te,name=NULL){\n    x1 <- NULL\n    x2 <- NULL\n    x3 <- NULL\n    \n    ## all emissions with secarrier as a main product\n    x1 <- dimSums(mselect(v_emi,all_enty=pecarrier,all_enty1=secarrier,all_te=te,all_enty2=emity),dim=3) \n    \n    ## negative term for couple products by technologies with secarrier as a main product\n    ## identify all techs with secarrier as a main product, create corresponding map for v_emi domain\n    sub_oc2te_secarMain <- oc2te[(oc2te$all_enty %in% pecarrier) & (oc2te$all_enty1 %in% secarrier) & (oc2te$all_enty2 %in% sety)    & (oc2te$all_te %in% te),]\n    \n    subEmi_oc2te_secarMain <- sub_oc2te_secarMain\n    if(length(row.names(subEmi_oc2te_secarMain))!=0){\n      subEmi_oc2te_secarMain$all_enty2 <- emity # replace the couple product column with emission column to fit the v_emi structure\n      x2 <- dimSums(collapseNames(v_emi[subEmi_oc2te_secarMain],collapsedim=3.4)*collapseNames(dataoc[sub_oc2te_secarMain]/(1+dataoc[sub_oc2te_secarMain]),collapsedim=3.4),dim=3)\n    }else{\n      x2 <- new.magpie(getRegions(x1),getYears(x1),magclass::getNames(x1),fill = 0)    \n    }\n    \n    ## additional term for technologies with secarrier as a couple product\n    ## identify all techs with secarrier as a couple product, create corresponding map for v_emi domain      \n    sub_oc2te_secarCP <- oc2te[(oc2te$all_enty %in% pecarrier) & (oc2te$all_enty1 %in% sety)    & (oc2te$all_enty2 %in% secarrier) & (oc2te$all_te %in% te),]\n    subEmi_oc2te_secarCP <- sub_oc2te_secarCP\n    if(length(row.names(subEmi_oc2te_secarCP))!=0){\n      subEmi_oc2te_secarCP$all_enty2 <- emity\n      x3 <- dimSums(collapseNames(v_emi[subEmi_oc2te_secarCP],3.4)*collapseNames(dataoc[sub_oc2te_secarCP]/(1+dataoc[sub_oc2te_secarCP]),collapsedim=3.4),dim=3)\n    }else{\n      x3 <- new.magpie(getRegions(x1),getYears(x1),magclass::getNames(x1),fill = 0)        \n    }\n    out <- (x1-x2+x3)*factor\n    if(!is.null(name)) magclass::getNames(out) <- name\n    return(out)\n  }\n  \n  ####### calculate reporting parameters ############\n  ### CO2 ###\n  tmp <- NULL\n  tmp <- mbind(\n    ### please note: at the end of this file, regional CO2 emissions are reduced by bunker emission values emissions are reduced by bunker emission values\n    setNames((vm_emiengregi[,,\"co2\"] + vm_sumeminegregi[,,\"co2\"] + vm_emicdrregi[,,\"co2\"]) * GtC_2_MtCO2,\t\"Emi|CO2 (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(vm_co2CCS,all_enty=\"cco2\"),dim=3)) * GtC_2_MtCO2,                 \"Emi|CO2|Carbon Capture and Storage (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(v_emi,all_enty=pebio,all_enty2=\"cco2\"),dim=3)) * GtC_2_MtCO2,    \"Emi|CO2|Carbon Capture and Storage|Biomass (Mt CO2/yr)\"), ## does not containt the IndustryCCS applied to Biogas, Biosolids, Bioliquids...\n    setNames((dimSums(mselect(v_emi,all_enty=peFos,all_enty2=\"cco2\"),dim=3)) * GtC_2_MtCO2,    \"Emi|CO2|Carbon Capture and Storage|Fossil|Pe2Se (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(v_emi,all_enty1=\"seel\",all_enty2=\"co2\"),dim=3)) * GtC_2_MtCO2,   \"Emi|CO2|Electricity Production|w/o couple prod (Mt CO2/yr)\"), ## does not account for couple production\n    setNames((dimSums(mselect(v_emi,all_enty1=\"seh2\",all_enty2=\"co2\"),dim=3)) * GtC_2_MtCO2,   \"Emi|CO2|Hydrogen Production|w/o couple prod (Mt CO2/yr)\"),   ## does not account for couple production\n    setNames((dimSums(mselect(v_emi,all_enty1=\"sehe\",all_enty2=\"co2\"),dim=3)) * GtC_2_MtCO2,   \"Emi|CO2|Heat Production|w/o couple prod (Mt CO2/yr)\"),  ## does not account for couple production\n    \n    # CO2 emissions from CHP are split joule-by-joule between electricity and \n    # heat\n    setNames(\n      ( v_emi[,,'pecoal.seel.coalchp.co2'] \n      / (1 + dataoc[,,'pecoal.seel.coalchp.sehe'])\n      * GtC_2_MtCO2\n      ),\n      'Emi|CO2|Electricity|Coal|CHP|w/o CCS (MtCO2/yr)'),\n    \n    setNames(\n      ( v_emi[,,'pecoal.seel.coalchp.co2'] \n      * dataoc[,,'pecoal.seel.coalchp.sehe']\n      / (1 + dataoc[,,'pecoal.seel.coalchp.sehe'])\n      * GtC_2_MtCO2\n      ),\n      'Emi|CO2|Heat|Coal|CHP|w/o CCS (MtCO2/yr)'),\n    \n    setNames(\n      ( v_emi[,,'pegas.seel.gaschp.co2'] \n      / (1 + dataoc[,,'pegas.seel.gaschp.sehe'])\n      * GtC_2_MtCO2\n      ),\n      'Emi|CO2|Electricity|Gas|CHP|w/o CCS (MtCO2/yr)'),\n    \n    setNames(\n      ( v_emi[,,'pegas.seel.gaschp.co2'] \n      * dataoc[,,'pegas.seel.gaschp.sehe']\n      / (1 + dataoc[,,'pegas.seel.gaschp.sehe'])\n      * GtC_2_MtCO2\n      ),\n      'Emi|CO2|Heat|Gas|CHP|w/o CCS (MtCO2/yr)'),\n      \n    ### please note: at the end of this file, regional FFI emissions are reduced by bunker emission values emissions are reduced by bunker emission values\n      setNames((vm_emiengregi[,,\"co2\"] + vm_eminegregi[,,\"co2cement_process\"]) * GtC_2_MtCO2,            \"Emi|CO2|Fossil Fuels and Industry (Mt CO2/yr)\"),\n    setNames((vm_eminegregi[,,\"co2cement_process\"]) * GtC_2_MtCO2,                                     \"Emi|CO2|Fossil Fuels and Industry|Cement process (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(v_emi,all_enty=\"peoil\",all_enty2=\"co2\")[emi2te],dim=3)\n              + dimSums(mselect(p_cint,all_enty=\"co2\",all_enty1=\"peoil\")[cintbyfuel]\n                        * vm_fuelex[,,\"peoil\"][cintbyfuel], dim=3)\n    ) * GtC_2_MtCO2,                                                                 \"Emi|CO2|Fossil Fuels and Industry|Oil|Before IndustryCCS (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(v_emi,all_enty=\"pegas\", all_enty2=\"co2\")[emi2te],dim=3)\n              + dimSums(mselect(p_cint,all_enty=\"co2\",all_enty1=\"pegas\")[cintbyfuel]\n                        * vm_fuelex[,,\"pegas\"][cintbyfuel], dim=3)\n    ) * GtC_2_MtCO2,                                                                 \"Emi|CO2|Fossil Fuels and Industry|Gas|Before IndustryCCS (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(v_emi,all_enty=\"pecoal\", all_enty2=\"co2\")[emi2te],dim=3) +\n                + dimSums(mselect(p_cint,all_enty=\"co2\",all_enty1=\"pecoal\")[cintbyfuel]\n                          * vm_fuelex[,,\"pecoal\"][cintbyfuel], dim=3)\n    ) * GtC_2_MtCO2,                                                                 \"Emi|CO2|Fossil Fuels and Industry|Coal|Before IndustryCCS (Mt CO2/yr)\"),\n    ### please note: at the end of this file, regional FFI demand emissions are reduced by bunker emission values\n    setNames( dimSums( (p_ef_dem[,,fety]*(1-p_bioshare[,,fety]))\n                       * dimSums(mselect(vm_prodFe,all_enty1=fety),dim=c(3.1,3.3))\n                       ,dim=3) ,                                     \"Emi|CO2|Fossil Fuels and Industry|Demand|Before IndustryCCS (Mt CO2/yr)\"),\n    ### please note: at the end of this file, regional Gross FFI emissions are reduced by bunker emission values\n    setNames((vm_emiengregi[,,\"co2\"] + vm_eminegregi[,,\"co2cement_process\"]) * GtC_2_MtCO2\n             + (dimSums(mselect(v_emi,all_enty=pebio,all_enty2=\"cco2\"),dim=3)) * GtC_2_MtCO2,    \"Emi|CO2|Gross Fossil Fuels and Industry (Mt CO2/yr)\"),\n    setNames((vm_eminegregi[,,\"co2luc\"] ) * GtC_2_MtCO2,                                         \"Emi|CO2|Land-Use Change (Mt CO2/yr)\")\n  )\n  \n  if (!is.null(v33_emiEW)){\n    tmp <- mbind(tmp,    \n                 setNames(v33_emiEW[,] * GtC_2_MtCO2,                                                       \"Emi|CO2|CDR|EW (Mt CO2/yr)\")\n    )\n    ### cumulated\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|CDR|EW (Mt CO2/yr)\"]),\"Emi|CO2|CDR|EW|Cumulated (Mt CO2/yr)\"))\n  }  \n  ### report only negative values of CO2 LUC as CDR\n  CDRco2luc <- new.magpie(getRegions(vm_eminegregi),getYears(vm_eminegregi),magclass::getNames(vm_eminegregi),fill=0)\n  CDRco2luc <- vm_eminegregi\n  CDRco2luc[CDRco2luc>0] <- 0\n\n  if (!is.null(v33_emiDAC)){\n    tmp <- mbind(tmp,    \n    setNames(v33_emiDAC * GtC_2_MtCO2,                                                         \"Emi|CO2|CDR|DAC (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(v_emi,all_enty=pebio,all_enty2=\"cco2\"),dim=3)) * GtC_2_MtCO2 * (-1), \"Emi|CO2|CDR|BECCS (Mt CO2/yr)\"), ## does not containt the IndustryCCS applied to Biogas, Biosolids, Bioliquids...\n    setNames(CDRco2luc[,,\"co2luc\"] * GtC_2_MtCO2,                                                          \"Emi|CO2|CDR|Land-Use Change (Mt CO2/yr)\"),\n    setNames((vm_emicdrregi[,,\"co2\"]-dimSums(mselect(v_emi,all_enty=pebio,all_enty2=\"cco2\"),dim=3)+CDRco2luc[,,\"co2luc\"]) * GtC_2_MtCO2, \"Emi|CO2|CDR (Mt CO2/yr)\"),\n    setNames((dimSums(mselect(vm_co2CCS,all_enty=\"cco2\"),dim=3) + v33_emiDAC) * GtC_2_MtCO2,   \"Carbon Sequestration|CCS (Mt CO2/yr)\"),\n    setNames(v33_emiDAC * GtC_2_MtCO2 * (-1),                                                  \"Carbon Sequestration|Direct Air Capture (Mt CO2/yr)\")\n    )\n  ### cumulated\n  tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|CDR|DAC (Mt CO2/yr)\"]),\"Emi|CO2|CDR|DAC|Cumulated (Mt CO2/yr)\"))\n  tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|CDR|BECCS (Mt CO2/yr)\"]),\"Emi|CO2|CDR|BECCS|Cumulated (Mt CO2/yr)\"))\n  tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|CDR|Land-Use Change (Mt CO2/yr)\"]), \"Emi|CO2|CDR|Land-Use Change|Cumulated (Mt CO2/yr)\"))\n  tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|CDR (Mt CO2/yr)\"]),    \"Emi|CO2|CDR|Cumulated (Mt CO2/yr)\"))    \n  }\n\n  \n  \n  # Emissions by PE and carrier, use function \"emi_carrier\" declared above ############################################################################\n  tmp <- mbind(tmp,\n    emi_carrier(v_emi,dataoc,oc2te,sety,pebio,\"seel\",\"cco2\",GtC_2_MtCO2,pe2se$all_te,      name=\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pebio,se_Liq,\"cco2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Liquids|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pebio,\"seh2\",\"cco2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Hydrogen|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pebio,\"sehe\",\"cco2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Heat|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pebio,\"sega\",\"cco2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Gases|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pety,\"seel\",\"co2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Energy|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pety,\"sehe\",\"co2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Energy|Supply|Heat|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pety,\"seh2\",\"co2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Energy|Supply|Hydrogen|w/ couple prod (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pety,se_Liq,\"co2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Energy|SupplyandDemand|Liquids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pety,\"sega\",\"co2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Energy|SupplyandDemand|Gases|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"),\n    emi_carrier(v_emi,dataoc,oc2te,sety,pety,\"seso\",\"co2\",GtC_2_MtCO2,te=pe2se$all_te,  name=\"Emi|CO2|Energy|SupplyandDemand|Solids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\")\n  )\n\n  \n  tmp <- mbind(tmp,\n    setNames(tmp[,,\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Heat|w/ couple prod (Mt CO2/yr)\"] + tmp[,,\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Gases|w/ couple prod (Mt CO2/yr)\"] + tmp[,,\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Liquids|w/ couple prod (Mt CO2/yr)\"] + tmp[,,\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"] + tmp[,,\"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|Hydrogen|w/ couple prod (Mt CO2/yr)\"],\n               \"Emi|CO2|Carbon Capture and Storage|Biomass|Supply|w/ couple prod (Mt CO2/yr)\"\n            )\n  )\n    \n  ### Industry CCS emissions ##########################################################################################\n  # for debugging purposes\n  # vm_macBaseIndRed <- collapseNames(mselect(vm_macBaseInd,all_enty = \"fegas\",secInd37 = secInd37_2_emiInd37$secInd37))\n  # a <- dimSums(vm_macBaseIndRed[,,] * setNames(pm_macSwitch[,,secInd37_2_emiInd37$emiInd37],secInd37_2_emiInd37$secInd37) * setNames(pm_macAbatLev[,,secInd37_2_emiInd37$emiInd37],secInd37_2_emiInd37$secInd37),3)\n  \n  if (is.null(v37_emiIndCCSmax)) {   # if not enough data for calculation\n    tmp2 <- new.magpie(\n      getRegions(tmp), getYears(tmp), \n      c(paste0('Emi|CO2|Carbon Capture and Storage|IndustryCCS|', \n               c('fesos', 'fehos', 'fegas'), ' (Mt CO2/yr)'),\n        'Emi|CO2|Carbon Capture and Storage|IndustryCCS|Process (Mt CO2/yr)'))\n  } else {\n    tmp2 <- vm_macBaseInd %>%   # baseline emissions from fuel burning\n      as.quitte() %>%\n      select(.data$period, .data$region, .data$all_enty, .data$secInd37, \n             .data$value) %>%\n      # does NOT account for process emissions!\n      filter(.data$all_enty %in% fety) %>%\n      rename(fety = .data$all_enty) %>%\n      character.data.frame() %>% \n      # link emissions emiInd37 to industry sector secInd37\n      inner_join(\n        secInd37_2_emiInd37 %>%\n          filter('co2cement_process' != emiInd37),\n        \n        'secInd37'\n      ) %>% \n      # Industry MAC is on or off?\n      inner_join(\n        pm_macSwitch %>%\n          as.quitte() %>%\n          select(emiInd37 = .data$all_enty, pm_macSwitch = .data$value) %>%\n          filter(.data$emiInd37 %in% secInd37_2_emiInd37$emiInd37) %>%\n          mutate(emiInd37 = as.character(.data$emiInd37)),\n        \n        'emiInd37'\n      ) %>% \n      inner_join(\n        # abatement level of industry sector MAC at current CO2 price\n        pm_macAbatLev %>%\n          as.quitte() %>%\n          select(.data$period, .data$region, emiInd37 = .data$all_enty, \n                 pm_macAbatLev = .data$value) %>%\n          filter(emiInd37 %in% secInd37_2_emiInd37$emiInd37) %>%\n          mutate(emiInd37 = as.character(.data$emiInd37),\n                 region = as.character(.data$region)),\n        \n        c('period', 'region', 'emiInd37')\n      ) %>%\n      inner_join(\n        inner_join(\n          vm_emiIndCCS %>% \n            as.quitte() %>% \n            select(.data$period, .data$region, .data$all_enty, \n                   vm_emiIndCCS = .data$value),\n          \n          v37_emiIndCCSmax %>% \n            as.quitte() %>% \n            select(.data$period, .data$region, .data$all_enty, \n                   v37_emiIndCCSmax = .data$value),\n          \n          c('period', 'region', 'all_enty')\n        ) %>% \n          mutate(slack = ifelse(.data$v37_emiIndCCSmax, \n                                .data$vm_emiIndCCS / .data$v37_emiIndCCSmax, 0),\n                 region = as.character(.data$region),\n                 emiInd37 = as.character(.data$all_enty)) %>% \n          select(.data$period, .data$region, .data$emiInd37, .data$slack),\n        \n        c('period', 'region', 'emiInd37')\n      ) %>% \n      tbl_df() %>%\n      group_by(.data$period, .data$region, .data$fety) %>%\n      summarise(\n        value = sum(.data$value * .data$pm_macSwitch * .data$pm_macAbatLev * .data$slack)) %>%\n      ungroup() %>%\n      mutate(\n        value = .data$value * GtC_2_MtCO2,\n        model = NA,\n        scenario = NA,\n        variable = paste0('Emi|CO2|Carbon Capture and Storage|IndustryCCS|', \n                          .data$fety, ' (Mt CO2/yr)')) %>%\n      select(.data$model, .data$scenario, .data$region, .data$variable, \n             .data$period, .data$value) %>%\n      as.quitte() %>%\n      as.magpie() \n    \n    dimnames(tmp2) <- setNames(dimnames(tmp2), names(dimnames(tmp)))\n    \n    # add cement process emissions\n    tmp2 <- mbind(\n      tmp2, \n      o37_cementProcessEmissions %>% \n        as.quitte() %>% \n        mutate(region = as.character(.data$region)) %>% \n        inner_join(\n          inner_join(\n            vm_emiIndCCS %>% \n              as.quitte() %>% \n              filter('co2cement' == .data$all_enty,\n                     .data$period %in% as.numeric(sub('^y', '', y))) %>% \n              select(.data$period, .data$region, vm_emiIndCCS = .data$value),\n            \n            v37_emiIndCCSmax %>% \n              as.quitte() %>% \n              filter('co2cement' == .data$all_enty,\n                     .data$period %in% as.numeric(sub('^y', '', y))) %>% \n              select(.data$period, .data$region, v37_emiIndCCSmax = .data$value),\n            \n            c('period', 'region')\n          ) %>% \n            mutate(slack = ifelse(.data$v37_emiIndCCSmax, \n                                  .data$vm_emiIndCCS / .data$v37_emiIndCCSmax, 0),\n                   region = as.character(.data$region)) %>% \n            select(.data$period, .data$region, .data$slack),\n          \n          c('period', 'region')\n        ) %>% \n        inner_join(\n          pm_macSwitch %>%\n            as.quitte() %>%\n            filter('co2cement_process' == .data$all_enty) %>% \n            select(pm_macSwitch = .data$value) %>% \n            mutate(period = 0) %>% \n            complete(nesting(pm_macSwitch), \n                     period = as.numeric(sub('^y', '', y))),\n          \n          'period'\n        ) %>% \n        inner_join(\n          # abatement level of industry sector MAC at current CO2 price\n          pm_macAbatLev %>%\n            as.quitte() %>%\n            filter('co2cement' == .data$all_enty) %>% \n            select(.data$period, .data$region, pm_macAbatLev = .data$value) %>%\n            mutate(region = as.character(.data$region)),\n          \n          c('period', 'region')\n        ) %>% \n        group_by(.data$period, .data$region) %>% \n        summarise(value = sum( .data$value \n                               * .data$pm_macSwitch \n                               * .data$pm_macAbatLev \n                               * .data$slack)\n                  * GtC_2_MtCO2) %>%\n        ungroup() %>% \n        as.quitte() %>% \n        as.magpie() %>% \n        setNames(\n          'Emi|CO2|Carbon Capture and Storage|IndustryCCS|Process (Mt CO2/yr)'))\n  }\n  \n  tmp2 <- mbind(\n    tmp2,\n    setNames( \n      tmp2[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fegas (Mt CO2/yr)\"] \n      + tmp2[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fesos (Mt CO2/yr)\"] \n      + tmp2[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fehos (Mt CO2/yr)\"]\n      + tmp2[,,'Emi|CO2|Carbon Capture and Storage|IndustryCCS|Process (Mt CO2/yr)'],\n      \"Emi|CO2|Carbon Capture and Storage|IndustryCCS (Mt CO2/yr)\")\n  )\n\n  tmp <- mbind(tmp, tmp2)\n  rm(tmp2)\n\n  ### please note: at the end of this file, regional  FFI demand emissions are reduced by bunker emission values\n  tmp <- mbind(tmp, \n    setNames(tmp[,,\"Emi|CO2|Fossil Fuels and Industry|Demand|Before IndustryCCS (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS (Mt CO2/yr)\"],\n                        \"Emi|CO2|Fossil Fuels and Industry|Demand|After IndustryCCS (Mt CO2/yr)\")\n  )\n  tmp <- mbind(tmp,\n    setNames(tmp[,,\"Emi|CO2|Fossil Fuels and Industry (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Fossil Fuels and Industry|Demand|After IndustryCCS (Mt CO2/yr)\"] - (vm_eminegregi[,,\"co2cement_process\"] * GtC_2_MtCO2),\n                        \"Emi|CO2|Fossil Fuels and Industry|Energy Supply (Mt CO2/yr)\"),\n                 \n               # setNames( vm_emiengregi[,,\"co2\"] * GtC_2_MtCO2\n               #           - dimSums( (p_ef_dem[,,fety]*(1-p_bioshare[,,fety]))\n               #                      * dimSums(mselect(vm_prodFe,all_enty1=fety),dim=c(3.1,3.3))\n               #                      ,dim=3) ,            \"Emi|CO2|Fossil Fuels and Industry|Energy Supply|Before IndustryCCS (Mt CO2/yr)\"),\n               \n    setNames( tmp[,,\"Emi|CO2|Gross Fossil Fuels and Industry (Mt CO2/yr)\"] + tmp[,,\"Emi|CO2|Carbon Capture and Storage|Biomass (Mt CO2/yr)\"],\n                         \"Emi|CO2|FFaI|Emi to which CO2tax is applied (Mt CO2/yr)\")\n  )\n  \n  tmp <- mbind(tmp,\n    setNames( ( p_bioshare[,,\"fegas\"] * tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fegas (Mt CO2/yr)\"] \n                + p_bioshare[,,\"fesos\"] * tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fesos (Mt CO2/yr)\"]\n                + p_bioshare[,,\"fehos\"] * tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fehos (Mt CO2/yr)\"]),\n      \"Emi|CO2|Carbon Capture and Storage|Biomass|Energy|Demand|Industry (Mt CO2/yr)\"),\n    setNames( ( (1-p_bioshare[,,\"fegas\"]) * tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fegas (Mt CO2/yr)\"] \n                + (1-p_bioshare[,,\"fesos\"]) * tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fesos (Mt CO2/yr)\"]\n                + (1-p_bioshare[,,\"fehos\"]) * tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fehos (Mt CO2/yr)\"]),\n      \"Emi|CO2|Carbon Capture and Storage|Fossil|Energy|Demand|Industry (Mt CO2/yr)\")\n  )\n  \n  # Direct emissions by final energy carrier ############################################################################\n  tmp <- mbind(tmp,\n               setNames( dimSums(p_ef_dem[,,FE_Ga] * (1 - p_bioshare[,,FE_Ga]) # biomass is valued at 0 for Demand emissions\n                                 * dimSums(mselect(vm_prodFe,all_enty1=FE_Ga),dim=c(3.1,3.3)),dim=3) , \"Emi|CO2|Energy|Demand|Gases|Before IndustryCCS (Mt CO2/yr)\"),\n               setNames( dimSums(p_ef_dem[,,FE_Liq] * (1 - p_bioshare[,,FE_Liq]) # biomass is valued at 0 for Demand emissions\n                                 * dimSums(mselect(vm_prodFe,all_enty1=FE_Liq),dim=c(3.1,3.3)),dim=3) , \"Emi|CO2|Energy|Demand|Liquids|Before IndustryCCS (Mt CO2/yr)\"),\n               setNames( dimSums(p_ef_dem[,,FE_So] * (1 - p_bioshare[,,FE_So]) # biomass is valued at 0 for Demand emissions\n                                 * dimSums(mselect(vm_prodFe,all_enty1=FE_So),dim=c(3.1,3.3)),dim=3) , \"Emi|CO2|Energy|Demand|Solids|Before IndustryCCS (Mt CO2/yr)\")\n               \n               # setNames( dimSums(p_ef_dem[,,FE_He] * (1 - p_bioshare[,,FE_He]) # biomass is valued at 0 for Demand emissions\n               #                   * dimSums(mselect(vm_prodFe,all_enty1=FE_He),dim=c(3.1,3.3)),dim=3) , \"Emi|CO2|Energy|Demand|Heat (Mt CO2/yr)\"),\n               # setNames( dimSums(p_ef_dem[,,FE_H2] * (1 - p_bioshare[,,FE_H2]) # biomass is valued at 0 for Demand emissions\n               #                   * dimSums(mselect(vm_prodFe,all_enty1=FE_H2),dim=c(3.1,3.3)),dim=3) , \"Emi|CO2|Energy|Demand|H2 (Mt CO2/yr)\"),\n               # setNames( dimSums(p_ef_dem[,,FE_El] * (1 - p_bioshare[,,FE_El]) # biomass is valued at 0 for Demand emissions\n               #                   * dimSums(mselect(vm_prodFe,all_enty1=FE_El),dim=c(3.1,3.3)),dim=3) , \"Emi|CO2|Energy|Demand|Electricity (Mt CO2/yr)\")\n               # \n  )\n  \n  # Direct emissions by final energy carrier, after industryCCS ############################################################################\n  tmp <- mbind(tmp, \n               setNames(tmp[,,\"Emi|CO2|Energy|Demand|Gases|Before IndustryCCS (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fegas (Mt CO2/yr)\"],\n                        \"Emi|CO2|Energy|Demand|Gases|After IndustryCCS (Mt CO2/yr)\"),\n               setNames(tmp[,,\"Emi|CO2|Energy|Demand|Liquids|Before IndustryCCS (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fehos (Mt CO2/yr)\"],\n                        \"Emi|CO2|Energy|Demand|Liquids|After IndustryCCS (Mt CO2/yr)\"),\n               setNames(tmp[,,\"Emi|CO2|Energy|Demand|Solids|Before IndustryCCS (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS|fesos (Mt CO2/yr)\"],\n                        \"Emi|CO2|Energy|Demand|Solids|After IndustryCCS (Mt CO2/yr)\")\n  )\n    \n  # Indirect/Supply emissions by final energy carrier, after industryCCS ############################################################################\n  tmp <- mbind(tmp, \n               setNames(tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Gases|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Energy|Demand|Gases|Before IndustryCCS (Mt CO2/yr)\"],\n                        \"Emi|CO2|Energy|Supply|Gases|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"),\n               setNames(tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Liquids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Energy|Demand|Liquids|Before IndustryCCS (Mt CO2/yr)\"] ,\n                        \"Emi|CO2|Energy|Supply|Liquids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"),\n               setNames(tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Solids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"] - tmp[,,\"Emi|CO2|Energy|Demand|Solids|Before IndustryCCS (Mt CO2/yr)\"] ,\n                        \"Emi|CO2|Energy|Supply|Solids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\")\n  ) \n    \n    \n  tmp <- mbind(tmp,   \n    setNames((p_share_seel_s * dimSums(mselect(v_emi,all_enty1=\"seel\",all_enty2=\"co2\")[pe2se],dim=3)\n              + p_share_seh2_s * dimSums(mselect(v_emi,all_enty1=\"seh2\",all_enty2=\"co2\")[pe2se],dim=3)\n              + p_share_seliq_s * dimSums(mselect(v_emi,all_enty1=se_Liq,all_enty2=\"co2\")[pe2se],dim=3)\n              + dimSums(mselect(v_emi,all_enty1=\"sega\",all_enty2=\"co2\")[pe2se],dim=3)\n              + dimSums(mselect(v_emi,all_enty1=\"seso\",all_enty2=\"co2\")[pe2se],dim=3)\n              + dimSums(mselect(v_emi,all_enty1=\"sehe\",all_enty2=\"co2\")[pe2se],dim=3)\n              + vm_eminegregi[,,\"co2cement_process\"]\n    ) * GtC_2_MtCO2,                     \"Emi|CO2|Other Sector|Direct and Indirect|w/o couple prod (Mt CO2/yr)\"), # sectoral emissions (couple production is not considered)\n    setNames((p_share_seel_s    * tmp[,,\"Emi|CO2|Energy|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"]\n              + p_share_seh2_s  * tmp[,,\"Emi|CO2|Energy|Supply|Hydrogen|w/ couple prod (Mt CO2/yr)\"]\n              + p_share_seliq_s * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Liquids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n              + 1 * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Gases|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n              + 1 * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Solids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n              + 1 * tmp[,,\"Emi|CO2|Energy|Supply|Heat|w/ couple prod (Mt CO2/yr)\"]\n              + vm_eminegregi[,,\"co2cement_process\"]\n              - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS (Mt CO2/yr)\"]\n    ),                     \"Emi|CO2|Other Sector|Direct and Indirect|w/ couple prod (Mt CO2/yr)\"), # sectoral emissions including couple production\n    setNames( dimSums( (p_ef_dem[,,FE_Stat_fety]*(1-p_bioshare[,,FE_Stat_fety]))\n                       * dimSums(mselect(vm_prodFe,all_enty1=FE_Stat_fety),dim=c(3.1,3.3))\n                       ,dim=3) ,                                                  \"Emi|CO2|Other Sector|Direct (Mt CO2/yr)\"),\n    ### please note: at the end of this file, regional transport emissions are reduced by bunker emission values\n    setNames((  p_share_seel_t  * dimSums(mselect(v_emi,all_enty1=\"seel\",all_enty2=\"co2\")[pe2se],dim=3)\n                + p_share_seh2_t  * dimSums(mselect(v_emi,all_enty1=\"seh2\",all_enty2=\"co2\")[pe2se],dim=3)\n                + p_share_seliq_t * dimSums(mselect(v_emi,all_enty1=se_Liq,all_enty2=\"co2\")[pe2se],dim=3)\n    ) * GtC_2_MtCO2,                                                         \"Emi|CO2|Transport|w/o couple prod (Mt CO2/yr)\"),# sectoral emissions (couple production is not considered)\n    \n    setNames((  p_share_seel_t  * tmp[,,\"Emi|CO2|Energy|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"]\n                + p_share_seh2_t  * tmp[,,\"Emi|CO2|Energy|Supply|Hydrogen|w/ couple prod (Mt CO2/yr)\"]\n                + p_share_seliq_t * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Liquids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n    ),                                                         \"Emi|CO2|Transport|w/ couple prod (Mt CO2/yr)\"),\n    ### please note: at the end of this file, regional transport emissions are reduced by bunker emission values\n    setNames( dimSums( (p_ef_dem[,,FE_Transp_fety35]*(1-p_bioshare[,,FE_Transp_fety35]))\n                       * dimSums(mselect(vm_prodFe,all_enty1=FE_Transp_fety35),dim=c(3.1,3.3))\n                       ,dim=3) ,                                          \"Emi|CO2|Transport|Demand (Mt CO2/yr)\"),\n    \n    setNames((  p_share_seel_t_ldv  * dimSums(mselect(v_emi,all_enty1=\"seel\",all_enty2=\"co2\")[pe2se],dim=3)\n                + p_share_seh2_t_ldv  * dimSums(mselect(v_emi,all_enty1=\"seh2\",all_enty2=\"co2\")[pe2se],dim=3)\n                + p_share_seliq_t_ldv * dimSums(mselect(v_emi,all_enty1=se_Liq,all_enty2=\"co2\")[pe2se],dim=3)\n    ) * GtC_2_MtCO2,                                                        \"Emi|CO2|Transport|Pass|Road|LDV (Mt CO2/yr)\"),\n    setNames( dimSums(p_ef_dem[,,FE_Transp_fety35][fe2es]\n                      * dimSums(mselect(vm_demFe,all_enty=FE_Transp_fety35,all_te=LDV35),dim=c(3.2,3.3))[fe2es]\n                      ,dim=3) ,                                         \"Emi|CO2|Transport|Pass|Road|LDV|Demand (Mt CO2/yr)\"),\n    setNames( p_share_seel_t_ldv  * dimSums(mselect(v_emi,all_enty1=\"seel\",all_enty2=\"co2\")[pe2se],dim=3)\n              * GtC_2_MtCO2,                                                         \"Emi|CO2|Transport|Pass|Road|LDV|Electricity (Mt CO2/yr)\"),\n    setNames( p_share_seh2_t_ldv  * dimSums(mselect(v_emi,all_enty1=\"seh2\",all_enty2=\"co2\")[pe2se],dim=3)\n              * GtC_2_MtCO2,                                                         \"Emi|CO2|Transport|Pass|Road|LDV|Hydrogen (Mt CO2/yr)\")\n  )\n  \n  ## create the normal aliases for the more detailed names that specify that couple production is included\n  tmp <- mbind(tmp,\n    setNames(tmp[,,\"Emi|CO2|Energy|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"],         \"Emi|CO2|Energy|Supply|Electricity (Mt CO2/yr)\"),\n    ### please note: at the end of this file, regional transport emissions are reduced by bunker emission values\n    setNames(tmp[,,\"Emi|CO2|Transport|w/ couple prod (Mt CO2/yr)\"],                         \"Emi|CO2|Transport (Mt CO2/yr)\"),\n    setNames(tmp[,,\"Emi|CO2|Other Sector|Direct and Indirect|w/ couple prod (Mt CO2/yr)\"],  \"Emi|CO2|Other Sector|Direct and Indirect (Mt CO2/yr)\"),\n    setNames(tmp[,,\"Emi|CO2|Fossil Fuels and Industry|Demand|After IndustryCCS (Mt CO2/yr)\"],  \"Emi|CO2|Fossil Fuels and Industry|Demand (Mt CO2/yr)\")\n  )\n  \n  tmp <- mbind(tmp,\n               setNames(tmp[,,\"Emi|CO2|Fossil Fuels and Industry|Energy Supply (Mt CO2/yr)\"] + tmp[,,\"Emi|CO2|Fossil Fuels and Industry|Demand (Mt CO2/yr)\"] ,\n                        \"Emi|CO2|Energy (Mt CO2/yr)\"))\n  \n  ### If Buildings Industry Structure ############################################################################\n  if (is.null(ppfen_stat)) {\n    \n    if (indu_mod %in% c('fixed_shares', 'subsectors')) {\n      tmp.emi.ind.dir <- setNames(\n        dimSums(o37_emiInd[,,\"co2\"], dim = 3, na.rm = TRUE)\n        * GtC_2_MtCO2,\n        \"Emi|CO2|Industry|Direct|FromGamsCalculation (Mt CO2/yr)\")\n    } else {\n      tmp.emi.ind.dir <- setNames(\n        dimSums(( p_ef_dem[,,FE_Stat_fety]\n                  * (1 - p_bioshare[,,FE_Stat_fety])\n                  * p_share_fety_i[,,FE_Stat_fety]\n        )\n        * dimSums(mselect(vm_prodFe, all_enty1 = FE_Stat_fety), dim = c(3.1, 3.3)),\n        dim = 3)\n        - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS (Mt CO2/yr)\"],\n        \"Emi|CO2|Industry|Direct (Mt CO2/yr)\")\n    }\n    \n    # FIXME: This will break the reporting if an unlisted industry module will \n    # is used. See issue #2399\n    tmp <- mbind(tmp,\n      setNames(\n      ( dimSums(( p_ef_dem[,,FE_Stat_fety]\n                * (1 - p_bioshare[,,FE_Stat_fety])\n                * p_share_fety_i[,,FE_Stat_fety]\n        )\n        * dimSums(mselect(vm_prodFe, all_enty1 = FE_Stat_fety), dim = c(3.1, 3.3)), dim = 3)\n        - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS (Mt CO2/yr)\"]), \"Emi|CO2|Industry|Direct (Mt CO2/yr)\")\n    )\n\n    tmp <- mbind(\n      tmp, \n      setNames(( p_share_feels_b * p_share_seel_s  * tmp[,,\"Emi|CO2|Energy|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"]\n               + p_share_feh2s_b * p_share_seh2_s  * tmp[,,\"Emi|CO2|Energy|Supply|Hydrogen|w/ couple prod (Mt CO2/yr)\"]\n               + p_share_fehos_b * p_share_seliq_s * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Liquids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n               + p_share_fegas_b * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Gases|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n               + p_share_fesos_b * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Solids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n               + p_share_fehes_b * tmp[,,\"Emi|CO2|Energy|Supply|Heat|w/ couple prod (Mt CO2/yr)\"]\n               ),        \"Emi|CO2|Buildings|Direct and Indirect (Mt CO2/yr)\"),\n      \n      setNames(dimSums( ( p_ef_dem[,,FE_Stat_fety]\n                        * (1 - p_bioshare[,,FE_Stat_fety])\n                        * p_share_fety_b[,,FE_Stat_fety]\n                        )\n                      * dimSums(mselect(vm_prodFe, all_enty1 = FE_Stat_fety), dim = c(3.1, 3.3)),\n                      dim = 3) ,\n               \"Emi|CO2|Buildings|Direct (Mt CO2/yr)\"),\n      \n      # Indirect gets calculated as difference further down in tmp4\n      setNames(( p_share_feels_i * p_share_seel_s  * tmp[,,\"Emi|CO2|Energy|Supply|Electricity|w/ couple prod (Mt CO2/yr)\"]\n                 + p_share_feh2s_i * p_share_seh2_s  * tmp[,,\"Emi|CO2|Energy|Supply|Hydrogen|w/ couple prod (Mt CO2/yr)\"]\n                 + p_share_fehos_i * p_share_seliq_s * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Liquids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n                 + p_share_fegas_i * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Gases|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n                 + p_share_fesos_i * tmp[,,\"Emi|CO2|Energy|SupplyandDemand|Solids|w/ couple prod|Before IndustryCCS (Mt CO2/yr)\"]\n                 + p_share_fehes_i * tmp[,,\"Emi|CO2|Energy|Supply|Heat|w/ couple prod (Mt CO2/yr)\"]\n                 - tmp[,,\"Emi|CO2|Carbon Capture and Storage|IndustryCCS (Mt CO2/yr)\"]   ## all industry CCS happens in industry\n      ),       \"Emi|CO2|Industry|Direct and Indirect (Mt CO2/yr)\"),\n\n    tmp.emi.ind.dir)\n  }\n  \n  \n  \n  ### calculate change of buildings emission due to the fact that all traditional biomass is used there, and assuming that half of the modern biomass is also used there #########################################################################\n  \n  aux_FE <- setNames(dimSums(vm_prodFe[,,\"seso.fesos.tdsos\"],dim=3),  \"FE|+|Solids (EJ/yr)\")\n  aux_FE <- mbind(aux_FE,\n                  setNames(p_bioshare[,,\"fesos\"] * aux_FE[,,\"FE|+|Solids (EJ/yr)\"], \"FE|Solids|Biomass (EJ/yr)\"),\n                  setNames(p_eta_conv[,,\"tdsos\"] * dimSums(vm_prodSE[,,\"biotr\"], dim = 3),     \"FE|Solids|Biomass|Traditional (EJ/yr)\"),\n                  setNames(p_eta_conv[,,\"tdsos\"] * dimSums(vm_prodSE[,,\"biotrmod\"], dim = 3),     \"FE|Solids|Biomass|Modern (EJ/yr)\"),\n                  setNames(dimSums(vm_cesIO[,,\"fesob\"],dim=3),          \"FE|Solids|Buildings (EJ/yr)\"),\n                  setNames(dimSums(vm_cesIO[,,\"fesoi\"],dim=3),          \"FE|Solids|Industry (EJ/yr)\")\n  )\n  aux_FE <- mbind(aux_FE,\n #                 setNames(pmin( aux_FE[,,\"FE|Solids|Biomass (EJ/yr)\"], aux_FE[,,\"FE|Solids|Buildings (EJ/yr)\"]), \"FE|Solids|Biomass|Buildings (EJ/yr)\"),\n                  setNames(p_bioshare[,,\"fesos\"] * aux_FE[,,\"FE|Solids|Buildings (EJ/yr)\"], \"FE|Solids|Buildings|OriginallyAccountedBiomass (EJ/yr)\")\n  )\n  \n  aux_FE2 <- new.magpie(getRegions(aux_FE),getYears(aux_FE),\"FE|Solids|Biomass|Buildings (EJ/yr)\",fill=0)\n  for( t in 1:length(getYears(aux_FE))){\n    for( r in 1:length(getRegions(aux_FE))){\n      aux_FE2[r,t,] <-  min( aux_FE[r,t,\"FE|Solids|Biomass|Traditional (EJ/yr)\"] + 0.5 * aux_FE[r,t,\"FE|Solids|Biomass|Modern (EJ/yr)\"], aux_FE[r,t,\"FE|Solids|Buildings (EJ/yr)\"])\n    }\n  }\n\n  aux_FE <- mbind(aux_FE,aux_FE2)\n  \n  aux_FE <- mbind(aux_FE,\n                  setNames(aux_FE[,,\"FE|Solids|Biomass|Buildings (EJ/yr)\"] - aux_FE[,,\"FE|Solids|Buildings|OriginallyAccountedBiomass (EJ/yr)\"], \"FE|Solids|Biomass|Buildings|NeedsAdditionalAccounting (EJ/yr)\")\n  )\n  aux_FE <- mbind(aux_FE,\n                  setNames(aux_FE[,,\"FE|Solids|Biomass|Buildings|NeedsAdditionalAccounting (EJ/yr)\"] * p_ef_dem[,,\"fesos\"] , \"Emi|CO2|Buildings|Solids|Biomass|NeedsToBeSubtracted (Mt CO2/yr)\")\n  )\n  \n\n  \n  # ,p_ef_dem[,,FE_So]\n  #     \n  #       setNames(p_bioshare[,,\"fesos\"] * aux_FE[,,\"FE|Buildings|Solids (EJ/yr)\"], \"FE|Solids|Buildings|OriginallyAccountedBiomass (EJ/yr)\")\n  #     )\n  #     p_bioshare[,,\"fesos\"] * aux_FE[,,\"FE|+|Solids (EJ/yr)\"], \"FE|Solids|Biomass (EJ/yr)\"),\n  # setNames(dimSums(vm_cesIO[,,\"fesob\"],dim=3),          \"FE|Buildings|Solids (EJ/yr)\"),\n  # ,\n  # setNames(dimSums(vm_cesIO[,,\"fesob\"],dim=3),          \"FE|Buildings|Solids (EJ/yr)\"),\n  #       vm_prodFe\n  #       p_bioshare[,,\"fesos\"] * \n  #       p_share_fesos_b)\n  # \n  # \n  # setNames(dimSums(prodFE[,,\"seso.fesos.tdsos\"],dim=3),  \"FE|+|Solids (EJ/yr)\"),\n  \n  \n  \n    ### calculate indirect transport emissions\n    tmp <- mbind(tmp,setNames( tmp[,,\"Emi|CO2|Transport (Mt CO2/yr)\"]\n                               - tmp[,,\"Emi|CO2|Transport|Demand (Mt CO2/yr)\"]\n                               ,\"Emi|CO2|Transport|Indirect (Mt CO2/yr)\"))  # For Transport, \"direct\" was called \"demand\" before  \n  \n    ### cumulated\n    ### please note: at the end of this file, regional values for \"Emi|CO2|Cumulated\", \"Emi|CO2|Transport|Cumulated\", \"Emi|CO2|Fossil Fuels and Industry|Cumulated\" and \"Emi|CO2|Gross Fossil Fuels and Industry|Cumulated\" are adjusted (substracting bunkers)\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Carbon Capture and Storage (Mt CO2/yr)\"]),\"Emi|CO2|Carbon Capture and Storage|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Carbon Capture and Storage|Fossil|Pe2Se (Mt CO2/yr)\"]),\"Emi|CO2|Carbon Capture and Storage|Fossil|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Carbon Capture and Storage|Biomass (Mt CO2/yr)\"]),\"Emi|CO2|Carbon Capture and Storage|Biomass|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2 (Mt CO2/yr)\"]),                           \"Emi|CO2|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Energy|Supply|Electricity (Mt CO2/yr)\"]),    \"Emi|CO2|Electricity Production|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Fossil Fuels and Industry (Mt CO2/yr)\"]), \"Emi|CO2|Fossil Fuels and Industry|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Gross Fossil Fuels and Industry (Mt CO2/yr)\"]), \"Emi|CO2|Gross Fossil Fuels and Industry|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Land-Use Change (Mt CO2/yr)\"]),           \"Emi|CO2|Land-Use Change|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Other Sector|Direct and Indirect (Mt CO2/yr)\"]),  \"Emi|CO2|Other Sector|Cumulated (Mt CO2/yr)\"))\n    tmp <- mbind(tmp,setNames(cumulatedValue(tmp[,,\"Emi|CO2|Transport (Mt CO2/yr)\"]),                 \"Emi|CO2|Transport|Cumulated (Mt CO2/yr)\"))\n   \n\n     ### F-Gases ###############################################################################\n    tmp1 <- NULL\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasC2F6\"],        \"Emi|C2F6 (kt C2F6/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasC6F14\"],       \"Emi|C6F14 (kt C6F14/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasCF4\"],         \"Emi|CF4 (kt CF4/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasTotal\"],       \"Emi|F-Gases (Mt CO2-equiv/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC\"],         \"Emi|HFC (kt HFC134a-equiv/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC125\"],      \"Emi|HFC|HFC125 (kt HFC125/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC134a\"],     \"Emi|HFC|HFC134a (kt HFC134a/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC143a\"],     \"Emi|HFC|HFC143a (kt HFC143a/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC227ea\"],    \"Emi|HFC|HFC227ea (kt HFC227ea/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC23\"],       \"Emi|HFC|HFC23 (kt HFC23/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC245fa\"],    \"Emi|HFC|HFC245fa (kt HFC245fa/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC32\"],       \"Emi|HFC|HFC32 (kt HFC32/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasHFC43-10\"],    \"Emi|HFC|HFC43-10 (kt HFC43-10/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasPFC\"],         \"Emi|PFC (kt CF4-equiv/yr)\"))\n    tmp1 <- mbind(tmp1,setNames( p_emi_fgas[,,\"emiFgasSF6\"],         \"Emi|SF6 (kt SF6/yr)\"))\n    \n    \n    ### CH4 ###############################################################################\n    tmp2 <- NULL\n    tmp2 <- mbind(tmp2,setNames( vm_sumeminegregi[,,\"ch4\"] + vm_emiengregi[,,\"ch4\"],      \"Emi|CH4 (Mt CH4/yr)\"))\n    tmp2 <- mbind(tmp2,setNames( cumulatedValue(tmp2[,,\"Emi|CH4 (Mt CH4/yr)\"]),           \"Emi|CH4|Cumulated (Mt CH4/yr)\"))\n    tmp2 <- mbind(tmp2,setNames( vm_emiengregi[,,\"ch4\"],                                  \"Emi|CH4|Energy Demand|ResCom (Mt CH4/yr)\"))\n    tmp2 <- mbind(tmp2,setNames( vm_eminegregi[,,\"ch4coal\"] + vm_eminegregi[,,\"ch4gas\"]\n                                 + vm_eminegregi[,,\"ch4oil\"],                             \"Emi|CH4|Energy Supply (Mt CH4/yr)\"))\n    tmp2 <- mbind(tmp2,setNames( vm_eminegregi[,,\"ch4coal\"] + vm_eminegregi[,,\"ch4gas\"]\n                               + vm_eminegregi[,,\"ch4oil\"]  + vm_emiengregi[,,\"ch4\"],     \"Emi|CH4|Energy Supply and Demand (Mt CH4/yr)\"))\n  tmp2 <- mbind(tmp2,setNames( vm_eminegregi[,,\"ch4coal\"] + vm_eminegregi[,,\"ch4gas\"]\n                               + vm_eminegregi[,,\"ch4oil\"],                             \"Emi|CH4|Fossil Fuels and Industry (Mt CH4/yr)\"))\n  tmp2 <- mbind(tmp2,setNames( dimSums(vm_eminegregi[,,emismacmagpiech4],dim=3),        \"Emi|CH4|Land Use (Mt CH4/yr)\"))\n  tmp2 <- mbind(tmp2,new.magpie(getRegions(tmp2),getYears(tmp2),\"Emi|CH4|Other (Mt CH4/yr)\",fill=0))\n  tmp2 <- mbind(tmp2,setNames( (vm_eminegregi[,,\"ch4wstl\"] + vm_eminegregi[,,\"ch4wsts\"]),\"Emi|CH4|Waste (Mt CH4/yr)\"))\n  \n  \n  ### N2O ################################################################################\n  tmp3 <- NULL\n  MtN2_to_ktN2O <- 44 / 28 * 1000\n  tmp3 <- mbind(tmp3,setNames((vm_sumeminegregi[,,\"n2o\"] + vm_emiengregi[,,\"n2o\"]) * MtN2_to_ktN2O,    \"Emi|N2O (kt N2O/yr)\"))\n  tmp3 <- mbind(tmp3,setNames(cumulatedValue(tmp3[,,\"Emi|N2O (kt N2O/yr)\"]),                            \"Emi|N2O|Cumulated (kt N2O/yr)\"))\n  tmp3 <- mbind(tmp3,setNames((vm_emiengregi[,,\"n2o\"] + vm_eminegregi[,,\"n2otrans\"]) * MtN2_to_ktN2O,  \"Emi|N2O|Energy Supply and Demand (kt N2O/yr)\"))\n  tmp3 <- mbind(tmp3,setNames((vm_emiengregi[,,\"n2o\"]) * MtN2_to_ktN2O,                                \"Emi|N2O|Energy Supply (kt N2O/yr)\"))\n  tmp3 <- mbind(tmp3,setNames((vm_eminegregi[,,\"n2otrans\"]) * MtN2_to_ktN2O,                           \"Emi|N2O|Energy Demand|Transport (kt N2O/yr)\"))\n  tmp3 <- mbind(tmp3,setNames( dimSums(vm_eminegregi[,,emismacmagpien2o],dim=3) * MtN2_to_ktN2O,       \"Emi|N2O|Land Use (kt N2O/yr)\"))\n  tmp3 <- mbind(tmp3,setNames((vm_eminegregi[,,\"n2owaste\"]) * MtN2_to_ktN2O,                           \"Emi|N2O|Waste (kt N2O/yr)\"))\n  tmp3 <- mbind(tmp3,setNames((vm_eminegregi[,,\"n2oadac\"] + vm_eminegregi[,,\"n2onitac\"] ) * MtN2_to_ktN2O, \"Emi|N2O|Industry (kt N2O/yr)\"))\n                               \n  ### Other ###############################################################################\n  tmp4 <- NULL\n  ### If Buildings Industry Structure\n  if (is.null(ppfen_stat)) {\n    tmp4 <- mbind(tmp4,setNames( tmp[,,\"Emi|CO2|Buildings|Direct and Indirect (Mt CO2/yr)\"]\n                             - tmp[,,\"Emi|CO2|Buildings|Direct (Mt CO2/yr)\"]\n                             ,\"Emi|CO2|Buildings|Indirect (Mt CO2/yr)\"))\n    tmp4 <- mbind(tmp4,setNames( tmp[,,\"Emi|CO2|Industry|Direct and Indirect (Mt CO2/yr)\"]\n                             - tmp[,,\"Emi|CO2|Industry|Direct (Mt CO2/yr)\"]\n                             ,\"Emi|CO2|Industry|Indirect (Mt CO2/yr)\"))\n    tmp4 <- mbind(tmp4,setNames( tmp4[,,\"Emi|CO2|Industry|Indirect (Mt CO2/yr)\"]\n                              + tmp4[,,\"Emi|CO2|Buildings|Indirect (Mt CO2/yr)\"]\n                              + tmp[,,\"Emi|CO2|Transport|Indirect (Mt CO2/yr)\"]\n                              ,\"Emi|CO2|Fossil Fuels and Industry|Indirect (Mt CO2/yr)\"))  \n\n  tmp4 <- mbind(tmp4,\n    setNames(tmp[,,\"Emi|CO2|Buildings|Direct and Indirect (Mt CO2/yr)\"], \"Emi|CO2|Buildings|Direct and Indirect|BeforeTradBiomassCorr (Mt CO2/yr)\"),\n    setNames(tmp[,,\"Emi|CO2|Buildings|Direct (Mt CO2/yr)\"],              \"Emi|CO2|Buildings|Direct|BeforeTradBiomassCorr (Mt CO2/yr)\"),\n    setNames(tmp[,,\"Emi|CO2|Industry|Direct and Indirect (Mt CO2/yr)\"],  \"Emi|CO2|Industry|Direct and Indirect|BeforeTradBiomassCorr (Mt CO2/yr)\"),\n    setNames(tmp[,,\"Emi|CO2|Industry|Direct (Mt CO2/yr)\"],               \"Emi|CO2|Industry|Direct|BeforeTradBiomassCorr (Mt CO2/yr)\")\n    )\n  \n    tmp[,,\"Emi|CO2|Buildings|Direct and Indirect (Mt CO2/yr)\"] <- tmp[,,\"Emi|CO2|Buildings|Direct and Indirect (Mt CO2/yr)\"] - aux_FE[,,\"Emi|CO2|Buildings|Solids|Biomass|NeedsToBeSubtracted (Mt CO2/yr)\"]\n    tmp[,,\"Emi|CO2|Buildings|Direct (Mt CO2/yr)\"]              <- tmp[,,\"Emi|CO2|Buildings|Direct (Mt CO2/yr)\"]              - aux_FE[,,\"Emi|CO2|Buildings|Solids|Biomass|NeedsToBeSubtracted (Mt CO2/yr)\"]\n    tmp[,,\"Emi|CO2|Industry|Direct and Indirect (Mt CO2/yr)\"]  <- tmp[,,\"Emi|CO2|Industry|Direct and Indirect (Mt CO2/yr)\"]  + aux_FE[,,\"Emi|CO2|Buildings|Solids|Biomass|NeedsToBeSubtracted (Mt CO2/yr)\"]\n    tmp[,,\"Emi|CO2|Industry|Direct (Mt CO2/yr)\"]               <- tmp[,,\"Emi|CO2|Industry|Direct (Mt CO2/yr)\"]               + aux_FE[,,\"Emi|CO2|Buildings|Solids|Biomass|NeedsToBeSubtracted (Mt CO2/yr)\"]\n    \n  }\n  \n  tmp4 <- mbind(tmp4,setNames(v_co2eq * GtC_2_MtCO2,                                      \"Emi|GHG|International Trading System (Mt CO2-equiv/yr)\"))\n  if(cm_emiscen==1|cm_emiscen==9){\n    tmp4 <- mbind(tmp4,setNames(tmp4[,,\"Emi|GHG|International Trading System (Mt CO2-equiv/yr)\"],\"Emi|Allowances (Mt CO2-equiv/yr)\"))\n  }else{\n    tmp4 <- mbind(tmp4,setNames(vm_perm * GtC_2_MtCO2,                                    \"Emi|Allowances (Mt CO2-equiv/yr)\"))\n  }\n  ### please note: at the end of this file, regional GHGtot emissions are reduced by bunker emission values emissions are reduced by bunker emission values\n  tmp4 <- mbind(tmp4,setNames( tmp[,,\"Emi|CO2 (Mt CO2/yr)\"]\n                               + s_GWP_CH4 * tmp2[,,\"Emi|CH4 (Mt CH4/yr)\"]\n                               + s_GWP_N2O * tmp3[,,\"Emi|N2O (kt N2O/yr)\"] / 1000,             \"Emi|GHGtot (Mt CO2-equiv/yr)\"))\n  tmp4 <- mbind(tmp4,setNames(cumulatedValue(tmp4[,,\"Emi|GHGtot (Mt CO2-equiv/yr)\"]),            \"Emi|GHGtot|Cumulated (Mt CO2-equiv/yr)\"))\n  \n  ### please note: at the end of this file, regional Kyoto emissions are reduced by bunker emission values emissions are reduced by bunker emission values\n  tmp4 <- mbind(tmp4,setNames( tmp[,,\"Emi|CO2 (Mt CO2/yr)\"]\n                               + s_GWP_CH4 * tmp2[,,\"Emi|CH4 (Mt CH4/yr)\"]\n                               + s_GWP_N2O * tmp3[,,\"Emi|N2O (kt N2O/yr)\"] / 1000\n                               + tmp1[,,\"Emi|F-Gases (Mt CO2-equiv/yr)\"],                            \"Emi|Kyoto Gases (Mt CO2-equiv/yr)\"))\n  # this variable contains the value without bunkers even for the GLO total. For the regions, it is identical to the one above (after adjustment at the end of this file)\n  tmp4 <- mbind(tmp4,setNames( tmp4[,,\"Emi|Kyoto Gases (Mt CO2-equiv/yr)\"]-\n                                 p35_bunker_share_in_nonldv_fe*(tmp[,,\"Emi|CO2|Transport|Demand (Mt CO2/yr)\"]-tmp[,,\"Emi|CO2|Transport|Pass|Road|LDV|Demand (Mt CO2/yr)\"]),\n                               \"Emi|Kyoto Gases|w/o Bunkers (Mt CO2-equiv/yr)\"))\n  tmp4 <- mbind(tmp4,setNames( p35_bunker_share_in_nonldv_fe*(tmp[,,\"Emi|CO2|Transport|Demand (Mt CO2/yr)\"]-tmp[,,\"Emi|CO2|Transport|Pass|Road|LDV|Demand (Mt CO2/yr)\"]),\n                               \"Emi|CO2|Transport|Bunkers (Mt CO2/yr)\"))\n  tmp4 <- mbind(tmp4,setNames(cumulatedValue(tmp4[,,\"Emi|CO2|Transport|Bunkers (Mt CO2/yr)\"]),            \"Emi|CO2|Transport|Bunkers|Cumulated (Mt CO2/yr)\"))\n    #calculate Kyoto Gases w/o Bunkers and Landuse\n  tmp4 <- mbind(tmp4,setNames(tmp4[,,\"Emi|Kyoto Gases|w/o Bunkers (Mt CO2-equiv/yr)\"]-tmp[,,\"Emi|CO2|Land-Use Change (Mt CO2/yr)\"],\n                                \"Emi|Kyoto Gases excl Land-Use Change|w/o Bunkers (Mt CO2-equiv/yr)\" ))\n\n  \n  out <- mbind(tmp,tmp1,tmp2,tmp3,tmp4)\n\n  # ---- report industry CCS emissions ----############################################################################\n  if (!is.null(o37_emiInd) & length(o37_emiInd) != 0) {\n    var <- list(\n      list(name = \"Emi|CO2|FFaI|Industry|Cement|Fuel|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", secInd37 = \"cement\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Cement|Fuel|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\",  secInd37 = \"cement\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Cement|Fuel|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\",  secInd37 = \"cement\",\n                       all_enty1 = \"co2\")),\n      \n      list(name = \"Emi|CO2|FFaI|Industry|Chemicals|Fuel|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", secInd37 = \"chemicals\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Chemicals|Fuel|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\",  secInd37 = \"chemicals\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Chemicals|Fuel|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\",  secInd37 = \"chemicals\",\n                       all_enty1 = \"co2\")),\n\n      list(name = \"Emi|CO2|FFaI|Industry|Steel|Fuel|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", secInd37 = \"steel\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Steel|Fuel|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\",  secInd37 = \"steel\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Steel|Fuel|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\",  secInd37 = \"steel\",\n                       all_enty1 = \"co2\")),\n\n      list(name = \"Emi|CO2|FFaI|Industry|other|Fuel|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", secInd37 = \"otherInd\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|other|Fuel|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\",  secInd37 = \"otherInd\",\n                       all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|other|Fuel|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\",  secInd37 = \"otherInd\",\n                       all_enty1 = \"co2\")),\n\n      list(name = \"Emi|CO2|FFaI|Industry|Cement (Mt CO2/yr)\",\n           code = list(secInd37 = \"cement\", all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Chemicals (Mt CO2/yr)\",\n           code = list(secInd37 = \"chemicals\", all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Steel (Mt CO2/yr)\",\n           code = list(secInd37 = \"steel\", all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|other (Mt CO2/yr)\",\n           code = list(secInd37 = \"otherInd\", all_enty1 = \"co2\")),\n      \n      list(name = \"Emi|CO2|FFaI|Industry|Cement|Fuel (Mt CO2/yr)\",\n           code = list(secInd37 = \"cement\", all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Chemicals|Fuel (Mt CO2/yr)\",\n           code = list(secInd37 = \"chemicals\", all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Steel|Fuel (Mt CO2/yr)\",\n           code = list(secInd37 = \"steel\", all_enty1 = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|other|Fuel (Mt CO2/yr)\",\n           code = list(secInd37 = \"otherInd\", all_enty1 = \"co2\")),\n      \n      list(name = \"Emi|CCO2|FFaI|Industry|Cement|Fuel|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", secInd37 = \"cement\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Cement|Fuel|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\",  secInd37 = \"cement\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Cement|Fuel|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\",  secInd37 = \"cement\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Cement|Fuel|Biomass (Mt CO2/yr)\",\n           code = list(all_enty = list(\"pebiolc\", \"pebioil\"),\n                       secInd37 = \"cement\", all_enty1 = \"cco2\")),\n\n      list(name = \"Emi|CCO2|FFaI|Industry|Chemicals|Fuel|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", secInd37 = \"chemicals\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Chemicals|Fuel|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\",  secInd37 = \"chemicals\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Chemicals|Fuel|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\",  secInd37 = \"chemicals\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Chemicals|Fuel|Biomass (Mt CO2/yr)\",\n           code = list(all_enty = list(\"pebiolc\", \"pebioil\"),\n                       secInd37 = \"chemicals\", all_enty1 = \"cco2\")),\n\n      list(name = \"Emi|CCO2|FFaI|Industry|Steel|Fuel|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", secInd37 = \"steel\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Steel|Fuel|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\",  secInd37 = \"steel\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Steel|Fuel|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\",  secInd37 = \"steel\",\n                       all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Steel|Fuel|Biomass (Mt CO2/yr)\",\n           code = list(all_enty = list(\"pebiolc\", \"pebioil\"),\n                       secInd37 = \"steel\", all_enty1 = \"cco2\")),\n\n      list(name = \"Emi|CCO2|FFaI|Industry|Cement (Mt CO2/yr)\",\n           code = list(secInd37 = \"cement\", all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Chemicals (Mt CO2/yr)\",\n           code = list(secInd37 = \"chemicals\", all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Steel (Mt CO2/yr)\",\n           code = list(secInd37 = \"steel\", all_enty1 = \"cco2\")),\n      \n      list(name = \"Emi|CCO2|FFaI|Industry|Cement|Fuel (Mt CO2/yr)\",\n           code = list(secInd37 = \"cement\", all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Chemicals|Fuel (Mt CO2/yr)\",\n           code = list(secInd37 = \"chemicals\", all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Steel|Fuel (Mt CO2/yr)\",\n           code = list(secInd37 = \"steel\", all_enty1 = \"cco2\")),\n      \n      list(name = \"Emi|CCO2|FFaI|Industry|Coal (Mt CO2/yr)\",\n           code = list(all_enty = \"pecoal\", all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Oil (Mt CO2/yr)\",\n           code = list(all_enty = \"peoil\", all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Gas (Mt CO2/yr)\",\n           code = list(all_enty = \"pegas\", all_enty1 = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Biomass (Mt CO2/yr)\",\n           code = list(all_enty = list(\"pebiolc\", \"pebioil\"),\n                       all_enty1 = \"cco2\"))\n    )\n\n    # compute industry emissions from fuel combustion\n    o37_emiInd[is.na(o37_emiInd)] <- 0\n    fuel.emissions <- mbind(\n      lapply(var,\n             function(x) {\n               setNames(dimSums(mselect(o37_emiInd, x$code)) * GtC_2_MtCO2,\n                        x$name)\n             }\n      )\n    )\n\n    # compute industry process emissions\n    var <- list(\n      list(name = \"Emi|CO2|FFaI|Industry|Cement (Mt CO2/yr)\",\n           code = list(all_enty = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Cement|Process (Mt CO2/yr)\",\n           code = list(all_enty = \"co2\")),\n      list(name = \"Emi|CO2|FFaI|Industry|Process (Mt CO2/yr)\",\n           code = list(all_enty = \"co2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Cement (Mt CO2/yr)\",\n           code = list(all_enty = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Cement|Process (Mt CO2/yr)\",\n           code = list(all_enty = \"cco2\")),\n      list(name = \"Emi|CCO2|FFaI|Industry|Process (Mt CO2/yr)\",\n           code = list(all_enty = \"cco2\"))\n    )\n\n    ife <- which(\n      grepl(\"Emi\\\\|C?CO2\\\\|FFaI\\\\|Industry\\\\|Cement \\\\(Mt CO2/yr\\\\)\",\n            magclass::getNames(fuel.emissions)))\n    infe <- which(\n      !grepl(\"Emi\\\\|C?CO2\\\\|FFaI\\\\|Industry\\\\|Cement \\\\(Mt CO2/yr\\\\)\",\n             magclass::getNames(fuel.emissions)))\n    \n    if (length(o37_cementProcessEmissions)) {\n      process.emissions <- mbind(\n        lapply(var,\n               function(x) {\n                 setNames(\n                   ( dimSums(mselect(o37_cementProcessEmissions, x$code))\n                   * GtC_2_MtCO2\n                   ),\n                   x$name)\n               }\n        )\n      )\n      \n      ipe <- which(\n        grepl(\"Emi\\\\|C?CO2\\\\|FFaI\\\\|Industry\\\\|Cement \\\\(Mt CO2/yr\\\\)\",\n              magclass::getNames(process.emissions)))\n      inpe <- which(\n        !grepl(\"Emi\\\\|C?CO2\\\\|FFaI\\\\|Industry\\\\|Cement \\\\(Mt CO2/yr\\\\)\",\n               magclass::getNames(process.emissions)))\n      \n      out <- mbind(\n        out,\n        fuel.emissions[,,ife] + process.emissions[,,ipe],\n        fuel.emissions[,,infe],\n        process.emissions[,,inpe]\n      )\n    } else {\n      out <- mbind(\n        out,\n        fuel.emissions[,,ife],\n        fuel.emissions[,,infe]\n      )\n    }\n  }\n    \n  # add global values\n  out <- mbind(out,dimSums(out,dim=1))\n\n  # correction of variables containing bunker fuel emissions:\n  all_regs <- getRegions(out)\n  # for all regions (excluding the world region \"GLO\")...\n  regs <- all_regs[all_regs!= \"GLO\"]\n  # ...and all variables that include bunker fuels...\n    vars_with_bunkers <- c(\"Emi|CO2 (Mt CO2/yr)\",\n                         \"Emi|CO2|Fossil Fuels and Industry (Mt CO2/yr)\",\n                         \"Emi|CO2|Gross Fossil Fuels and Industry (Mt CO2/yr)\",\n                         \"Emi|CO2|Fossil Fuels and Industry|Demand|Before IndustryCCS (Mt CO2/yr)\",\n                         \"Emi|CO2|Fossil Fuels and Industry|Demand (Mt CO2/yr)\",\n                         \"Emi|CO2|Fossil Fuels and Industry|Demand|After IndustryCCS (Mt CO2/yr)\",\n                         \"Emi|Kyoto Gases (Mt CO2-equiv/yr)\",\n                         \"Emi|GHGtot (Mt CO2-equiv/yr)\",\n                         \"Emi|CO2|Transport (Mt CO2/yr)\",\n                         \"Emi|CO2|Transport|Demand (Mt CO2/yr)\",\n                         \"Emi|CO2|Transport|w/o couple prod (Mt CO2/yr)\"\n                         )\n  for (var in vars_with_bunkers){\n    # ...re-calculate the regional values by substracting the emissions from bunkers.\n    out[regs,,var] <- \n      out[regs,,var]- \n      out[regs,,\"Emi|CO2|Transport|Bunkers (Mt CO2/yr)\"]\n  }\n  #same as above for cumulated values\n    cum_with_bunkers <- c(\"Emi|CO2|Cumulated (Mt CO2/yr)\",\n                           \"Emi|CO2|Fossil Fuels and Industry|Cumulated (Mt CO2/yr)\",\n                           \"Emi|CO2|Gross Fossil Fuels and Industry|Cumulated (Mt CO2/yr)\",\n                           \"Emi|GHGtot|Cumulated (Mt CO2-equiv/yr)\"\n    )\n    for (var in cum_with_bunkers){\n      out[regs,,var] <- \n        out[regs,,var] - \n        out[regs,,\"Emi|CO2|Transport|Bunkers|Cumulated (Mt CO2/yr)\"]\n    } \n    \n  return(out)\n}\n",
    "created" : 1487968965265.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "913656358",
    "id" : "DFDFB74C",
    "lastKnownWriteTime" : 1533202911,
    "last_content_update" : 1533202911,
    "path" : "~/Documents/work/libraries/remind/R/reportEmi.R",
    "project_path" : "R/reportEmi.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}